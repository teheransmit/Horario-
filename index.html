<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Horario</title>
  <!-- Fuentes y librerías -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --bg-dark: #121212;
      --bg-card: #1f1f1f;
      --accent: #4f93ff;
      --accent-light: #6aa7ff;
      --text-light: #e0e0e0;
      --text-dark: #212121;
      --border-color: #333;
      --shadow: rgba(0, 0, 0, 0.5);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg-dark);
      color: var(--text-light);
      font-family: 'Inter', sans-serif;
      padding: 20px;
    }
    h1 {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: #fff;
      padding: 16px;
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow);
    }
    .config, .formulario {
      display: grid;
      gap: 16px;
      margin-top: 20px;
      background: var(--bg-card);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow);
    }
    .config {
      grid-template-columns: 1fr 1fr 1fr auto auto;
      align-items: end;
    }
    .config .form-group.title {
      grid-column: 1 / -1;
    }
    .config label, .formulario label {
      font-weight: 600;
      display: block;
      color: var(--text-light);
      margin-bottom: 6px;
    }
    .config input[type="text"],
    .formulario input,
    .formulario select {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      background: #2a2a2a;
      color: var(--text-light);
    }
    .formulario {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    button {
      padding: 12px;
      background: var(--accent);
      border: none;
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 6px var(--shadow);
    }
    button:hover {
      background: var(--accent-light);
    }
    .contenedor-horarios {
      display: flex;
      flex-direction: column;
      gap: 40px;
      margin-top: 30px;
    }
    .bloque-horario h2 {
      margin: 0 0 12px 0;
      color: var(--accent-light);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-card);
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--shadow);
    }
    th, td {
      border: 1px solid var(--border-color);
      padding: 8px;
      vertical-align: top;
    }
    th {
      background: #2a2a2a;
      color: var(--accent-light);
    }
    td:first-child {
      background: #2a2a2a;
      color: var(--accent-light);
      font-weight: 600;
    }
    tr:nth-child(even) td:not(:first-child) {
      background: #242424;
    }
    .clase {
      display: block;
      padding: 4px;
      margin: 4px 0;
      border-radius: 6px;
      box-shadow: 0 1px 2px var(--shadow);
      text-align: center;
      font-size: 0.75em;
      color: var(--text-dark);
      cursor: move;
      white-space: pre-line;
    }
    #modalBackdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    #modal {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      box-shadow: 0 4px 12px var(--shadow);
    }
  </style>
</head>
<body>
  <h1>Gestor de Horarios</h1>

  <div class="config">
    <div class="form-group title">
      <label for="tituloHorario">Título del horario</label>
      <input type="text" id="tituloHorario" placeholder="Ej: Horario Semestral">
    </div>
    <div class="form-group">
      <label for="horaMin">Hora mínima</label>
      <input type="time" id="horaMin" value="06:00">
    </div>
    <div class="form-group">
      <label for="horaMax">Hora máxima</label>
      <input type="time" id="horaMax" value="22:00">
    </div>
    <button id="generarTabla">Generar Nuevo Horario</button>
    <button id="exportar">Exportar PDF</button>
  </div>

  <div class="formulario">
    <div class="form-group">
      <label for="materia">Materia</label>
      <input type="text" id="materia" placeholder="Nombre de la materia">
    </div>
    <div class="form-group">
      <label for="nrc">NRC</label>
      <input type="text" id="nrc" placeholder="Código NRC">
    </div>
    <div class="form-group">
      <label for="profesor">Profesor</label>
      <input type="text" id="profesor" placeholder="Nombre del profesor">
    </div>
    <div class="form-group">
      <label for="colorMateria">Color Materia</label>
      <input type="color" id="colorMateria" value="#ff8a80">
    </div>
    <div class="form-group">
      <label for="dia">Día</label>
      <select id="dia">
        <option>Lunes</option>
        <option>Martes</option>
        <option>Miércoles</option>
        <option>Jueves</option>
        <option>Viernes</option>
        <option>Sábado</option>
      </select>
    </div>
    <div class="form-group">
      <label for="horaInicio">Hora inicio</label>
      <select id="horaInicio"></select>
    </div>
    <div class="form-group">
      <label for="horaFin">Hora fin</label>
      <select id="horaFin"></select>
    </div>
    <button onclick="agregarClase()">Agregar Clase</button>
  </div>

  <div class="contenedor-horarios" id="contenedorHorarios"></div>

  <!-- Modal edición -->
  <div id="modalBackdrop">
    <div id="modal">
      <h2>Editar Clase</h2>
      <div class="form-group">
        <label>Materia
        <input type="text" id="editMateria">
        </label>
      </div>
      <div class="form-group">
        <label>NRC
        <input type="text" id="editNrc">
        </label>
      </div>
      <div class="form-group">
        <label>Profesor
        <input type="text" id="editProf">
        </label>
      </div>
      <div class="form-group">
        <label>Color
        <input type="color" id="editColor">
        </label>
      </div>
      <button id="saveEdit">Guardar</button>
    </div>
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    let scheduleCount = 0, currentScheduleId = null, count = 0;

    function generarHoras(min, max) {
      const ops = [];
      let [hMin] = min.split(':').map(Number);
      let [hMax] = max.split(':').map(Number);
      for (let h = hMin; h <= hMax; h++) {
        for (let m = 0; m < 60; m += 10) {
          ops.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);
        }
      }
      return ops;
    }

    function crearBloqueHorario() {
      const tituloInput = document.getElementById('tituloHorario').value.trim();
      const titulo = tituloInput || `Horario ${scheduleCount + 1}`;
      const min = document.getElementById('horaMin').value;
      const max = document.getElementById('horaMax').value;
      const horas = generarHoras(min, max);
      const filas = horas.filter(h => h.endsWith(':00'));

      const id = `sched-${scheduleCount++}`;
      currentScheduleId = id;

      const cont = document.getElementById('contenedorHorarios');
      const bloque = document.createElement('div');
      bloque.className = 'bloque-horario';
      bloque.id = id;

      bloque.innerHTML = `
        <h2>${titulo}</h2>
        <table>
          <thead>
            <tr>
              <th>Hora</th>
              ${['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado']
                .map(d => `<th>${d}</th>`)
                .join('')}
            </tr>
          </thead>
          <tbody id="body-${id}"></tbody>
        </table>`;

      cont.appendChild(bloque);

      const body = document.getElementById(`body-${id}`);
      filas.forEach(h => {
        const row = document.createElement('tr');
        let html = `<td>${h}</td>`;
        ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado'].forEach(d => {
          html += `<td data-sched="${id}" data-dia="${d}" data-hora="${h}" ondragover="allowDrop(event)" ondrop="drop(event)"></td>`;
        });
        row.innerHTML = html;
        body.appendChild(row);
      });

      poblarSelects(horas);
    }

    function poblarSelects(horas) {
      ['horaInicio', 'horaFin'].forEach(id => {
        const sel = document.getElementById(id);
        sel.innerHTML = '';
        horas.forEach(h => sel.appendChild(new Option(h, h)));
      });
    }

    document.getElementById('generarTabla').onclick = crearBloqueHorario;

    function allowDrop(e) { e.preventDefault(); }
    function drag(e) { e.dataTransfer.setData('text/plain', e.target.id); }
    function drop(e) {
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      const el = document.getElementById(id);
      if (e.target.tagName === 'TD') {
        e.target.appendChild(el);
      }
    }

    function agregarClase() {
      if (!currentScheduleId) return alert('Genera primero un horario');
      const mat = document.getElementById('materia').value.trim();
      const nrc = document.getElementById('nrc').value.trim();
      const prof = document.getElementById('profesor').value.trim();
      const color = document.getElementById('colorMateria').value;

      if (!mat || !nrc) return alert('Completa Materia y NRC');

      const dia = document.getElementById('dia').value;
      const ini = document.getElementById('horaInicio').value;
      const fin = document.getElementById('horaFin').value;
      const start = parseInt(ini.split(':')[0]);
      const end = parseInt(fin.split(':')[0]);

      document.querySelectorAll(`td[data-sched="${currentScheduleId}"]`).forEach(cell => {
        if (cell.dataset.dia === dia) {
          const h = parseInt(cell.dataset.hora.split(':')[0]);
          if (h >= start && h < end) {
            const div = document.createElement('div');
            div.className = 'clase';
            div.id = 'clase-' + (count++);
            div.textContent = `${mat}\n${nrc}\n${prof}`;
            div.style.backgroundColor = color;
            div.draggable = true;
            div.addEventListener('dragstart', drag);
            cell.appendChild(div);
          }
        }
      });
    }

    // Inicializar con un horario
    window.onload = crearBloqueHorario;
  </script>
</body>
</html>
